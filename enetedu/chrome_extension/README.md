# 教师网课助手 Pro - 开发者文档

本文档包含插件的功能介绍、开发、混淆构建、打包发布以及授权管理流程。

## 💡 功能特性

本插件基于 Chrome 扩展架构开发，专为网课学习场景优化，提供商业级的稳定性和体验。

### 1. 核心刷课能力
*   **全自动学习**：进入视频页后自动播放、自动静音。
*   **智能倍速**：
    *   普通课程默认 3.0 倍速。
    *   直播回放支持高达 5.0 倍速。
    *   支持 SmartEdu 和 启城科技 平台的特定倍速策略。
*   **无人值守**：
    *   自动识别并关闭学习过程中的弹窗问题。
    *   当前章节学习完成后，**自动跳转播放下一集**。
    *   监测进度卡死（10分钟无变化）自动刷新页面。

### 2. 高效多开模式
*   **一键批量学习**：在“我的课程”列表页，点击插件面板的 **"列表页一键多开"**。
*   **智能识别**：自动分析当前列表页中所有状态为“学习”的课程。
*   **后台静默运行**：批量在后台打开标签页，互不干扰，配合 Tab 限制移除技术，实现多课程并行挂机。

### 3. 技术黑科技
*   **Tab 限制移除**：内置 Hook 脚本，解除浏览器对后台标签页的资源限制（Visibility API），确保页面在后台/最小化时依然正常计时，不暂停。
*   **跨平台兼容**：
    *   中国教育干部网络学院 (enetedu.com)
    *   智慧教育平台 (smartedu.cn)
    *   启城科技 (qchengkeji.com)

### 4. 商业授权系统
*   **RSA 安全验证**：采用非对称加密算法生成授权码，无需部署验证服务器，纯本地离线验证，低成本高安全。
*   **有效期控制**：授权码包含过期时间，插件自动校验。
*   **防篡改机制**：通过网络请求校验服务器时间，防止用户修改本地系统时间绕过验证。
*   **用户标识**：支持在授权码中写入客户名称，激活后在界面显示“授权给：XXX”，提升尊享感。

---

## 目录结构说明

```text
chrome_extension/
├── admin/                  # 【管理员专用】
│   ├── 1_generate_keys.js  # 生成RSA密钥对（首次运行一次即可）
│   ├── 2_issue_license.js  # 给客户生成授权码
│   └── private_key.pem     # 私钥（严禁泄露！）
├── extension/              # 【插件源码】（开发时加载此目录）
│   ├── manifest.json
│   ├── popup.html
│   ├── popup.js
│   ├── content.src.js      # 核心逻辑源码（开发改这里）
│   ├── content.js          # 混淆后的代码（发布用这个）
│   ├── inject.js           # 注入页面的脚本
│   ├── public_key.js       # 公钥（自动生成）
│   └── icons/
├── build.js                # 构建脚本（负责混淆代码）
├── package.json            # 项目依赖配置
└── README.md               # 本文档
```

---

## 一、 环境搭建

你需要安装 Node.js 环境。

1. **初始化项目**
   在 `chrome_extension` 目录下打开终端：

   ```bash
   npm init -y
   ```

2. **安装混淆工具**
   *注意：如果你遇到权限错误（EPERM），请尝试使用管理员身份打开终端，或清理 npm 缓存。*

   ```bash
   npm install --save-dev javascript-obfuscator fs-extra
   ```

---

## 二、 开发与构建（代码混淆）

为了保护核心逻辑，我们需要将 `content.src.js`（源码）混淆为 `content.js`（发布代码）。

### 1. 准备工作
将现有的 `extension/content.js` 重命名为 `extension/content.src.js`，作为你的开发源码。

### 2. 运行构建
每次修改完源码后，运行以下命令生成混淆代码：

```bash
node build.js
```

构建成功后，`extension/content.js` 将变成难以阅读的乱码，但功能保持不变。

---

## 三、 授权管理（如何卖卡密）

### 1. 初始化密钥（仅第一次）
运行以下命令，生成你的专属私钥和公钥：

```bash
node admin/1_generate_keys.js
```
*   `admin/private_key.pem`: **私钥**。这是你的印钞机，千万不要发给别人，也不要打包进插件里。
*   `extension/public_key.js`: **公钥**。会自动写入插件目录，用于验证签名。

### 2. 生成客户授权码
当用户付费后，修改 `admin/2_issue_license.js` 中的配置：

```javascript
const userNote = '客户张三';      // 备注
const deadline = '2025-12-31';   // 过期时间
```

然后运行：

```bash
node admin/2_issue_license.js
```

终端会输出一串字符（例如 `eyJh...`），这就是**激活码**。发送给用户即可。

---

## 四、 插件发布与安装

1. **打包**
   *   确保已经运行过 `node build.js`。
   *   将 `extension` 文件夹打包为 `extension.zip`。
   *   或者直接发送 `extension` 文件夹给用户。

2. **用户安装**
   *   打开 Chrome 浏览器，访问 `chrome://extensions/`。
   *   开启右上角 **"开发者模式"**。
   *   点击 **"加载已解压的扩展程序"**。
   *   选择 `extension` 文件夹。

3. **用户激活**
   *   点击浏览器右上角的插件图标。
   *   粘贴你发给他的 **激活码**。
   *   点击激活，开始使用。

---

## 常见问题

**Q: 我修改了代码，为什么插件没变化？**
A: 每次修改 `content.src.js` 后，必须运行 `node build.js`，然后在 Chrome 扩展页面点击 **"刷新"** 按钮（环形箭头）。

**Q: 混淆后的代码报错怎么办？**
A: 混淆可能会破坏某些依赖特定变量名的逻辑。如果报错，请检查 `build.js` 中的混淆配置，尝试降低保护强度（例如关闭 `renameGlobals`）。

**Q: 如何防止用户修改系统时间破解？**
A: 代码中已经内置了 `fetch(window.location.href)` 获取服务器时间头的逻辑。只要用户联网，修改本地时间是无效的。
