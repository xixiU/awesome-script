# å­—å¹•åŠŸèƒ½æ•…éšœæ’æŸ¥æŒ‡å—

## ğŸ”§ å¿«é€Ÿè¯Šæ–­å·¥å…·

**åœ¨æ§åˆ¶å°ï¼ˆF12ï¼‰è¿è¡Œä»¥ä¸‹ä»£ç ï¼š**

```javascript
// å¤åˆ¶ è¯Šæ–­å·¥å…·.js çš„å†…å®¹å¹¶ç²˜è´´åˆ°æ§åˆ¶å°è¿è¡Œ
// æˆ–è€…ç›´æ¥è¿è¡Œä¸‹é¢çš„ç®€åŒ–ç‰ˆæœ¬ï¼š

const video = document.querySelector('video');
const videoSrc = video.currentSrc || video.src;
console.log('è§†é¢‘åœ°å€:', videoSrc);
console.log('é¡µé¢åœ°å€:', location.origin);
console.log('æ˜¯å¦è·¨åŸŸ:', new URL(videoSrc).origin !== location.origin ? 'âŒ ä¸æ”¯æŒ' : 'âœ… æ”¯æŒ');
console.log('æ˜¯å¦æ’­æ”¾:', !video.paused ? 'âœ… æ’­æ”¾ä¸­' : 'âŒ æœªæ’­æ”¾');
```

**å®Œæ•´è¯Šæ–­ï¼š** ä½¿ç”¨ [è¯Šæ–­å·¥å…·.js](./è¯Šæ–­å·¥å…·.js)

---

## âš ï¸ è·¨åŸŸè§†é¢‘é™åˆ¶ï¼ˆæœ€å¸¸è§é—®é¢˜ï¼‰

### ç—‡çŠ¶

```
[å­—å¹•] âœ… éŸ³é¢‘æ•è·åˆå§‹åŒ–æˆåŠŸ
[å­—å¹•] âŒ å½•åˆ¶å¯åŠ¨å¤±è´¥: NotSupportedError
æˆ–
[å­—å¹•] å¤„ç†éŸ³é¢‘æ•°æ®ï¼Œchunks: 0
```

### åŸå› 

**YouTubeã€TED ç­‰ç½‘ç«™çš„è§†é¢‘ä» CDN åŠ è½½ï¼ˆè·¨åŸŸï¼‰ï¼Œæµè§ˆå™¨å®‰å…¨ç­–ç•¥é˜»æ­¢éŸ³é¢‘æ•è·ã€‚**

### æ£€æŸ¥æ˜¯å¦è·¨åŸŸ

```javascript
// åœ¨æ§åˆ¶å°è¿è¡Œ
const video = document.querySelector('video');
console.log('è§†é¢‘åœ°å€:', video.currentSrc);
console.log('é¡µé¢åœ°å€:', location.origin);
// å¦‚æœä¸¤ä¸ªåŸŸåä¸åŒï¼Œå°±æ˜¯è·¨åŸŸ
```

### å“ªäº›ç½‘ç«™å¯ä»¥ç”¨ï¼Ÿ

**âœ… å¯ä»¥ä½¿ç”¨ï¼ˆåŒåŸŸè§†é¢‘ï¼‰ï¼š**

- Bilibiliï¼ˆBç«™ï¼‰- å¤§éƒ¨åˆ†è§†é¢‘
- æŸäº›å›½å†…è§†é¢‘ç½‘ç«™
- æœ¬åœ°è§†é¢‘æ–‡ä»¶

**âŒ æ— æ³•ä½¿ç”¨ï¼ˆè·¨åŸŸè§†é¢‘ï¼‰ï¼š**

- YouTubeï¼ˆè§†é¢‘ä» googlevideo.com åŠ è½½ï¼‰
- TEDï¼ˆè§†é¢‘ä» CDN åŠ è½½ï¼‰
- å¤§éƒ¨åˆ†å›½å¤–ç½‘ç«™

### è§£å†³æ–¹æ¡ˆ

**æ–¹æ¡ˆ Aï¼šä»…åœ¨æ”¯æŒçš„ç½‘ç«™ä½¿ç”¨**

- åœ¨ Bç«™ç­‰åŒåŸŸè§†é¢‘ç½‘ç«™ä½¿ç”¨å­—å¹•åŠŸèƒ½
- è·¨åŸŸç½‘ç«™ä½¿ç”¨å…¶ä»–å¿«æ·é”®åŠŸèƒ½

**æ–¹æ¡ˆ Bï¼šä½¿ç”¨æµè§ˆå™¨æ‰©å±•ï¼ˆæœªæ¥ï¼‰**

- è€ƒè™‘å¼€å‘ Chrome æ‰©å±•ç‰ˆæœ¬
- æ‰©å±•æœ‰æ›´é«˜æƒé™ï¼Œå¯ä»¥æ•è·è·¨åŸŸéŸ³é¢‘

**æ–¹æ¡ˆ Cï¼šæ‰‹åŠ¨å­—å¹•**

- ä½¿ç”¨ç½‘ç«™è‡ªå¸¦çš„å­—å¹•åŠŸèƒ½
- æˆ–ä½¿ç”¨ç¬¬ä¸‰æ–¹å­—å¹•æ’ä»¶

---

## ğŸ› é—®é¢˜ 1ï¼šæŒ‰é’®çœ‹ä¸åˆ°

### ç—‡çŠ¶

- æ§åˆ¶å°æ˜¾ç¤º"[å­—å¹•] æŒ‰é’®å·²æ·»åŠ åˆ°æ§åˆ¶æ "
- ä½†é¡µé¢ä¸Šçœ‹ä¸åˆ°æŒ‰é’®

### æ’æŸ¥æ­¥éª¤

1. **æ£€æŸ¥æŒ‰é’®æ˜¯å¦çœŸçš„å­˜åœ¨**

```javascript
// åœ¨æ§åˆ¶å°ï¼ˆF12ï¼‰è¿è¡Œ
document.querySelector('.gm-subtitle-btn')
// åº”è¯¥è¿”å›ä¸€ä¸ªå…ƒç´ ï¼Œä¸æ˜¯ null
```

2. **æ£€æŸ¥æŒ‰é’®ä½ç½®**

```javascript
// æ£€æŸ¥æµ®åŠ¨æŒ‰é’®
const btn = document.querySelector('.gm-floating-btn');
if (btn) {
    console.log('æŒ‰é’®ä½ç½®:', btn.style.bottom, btn.style.right);
    console.log('æŒ‰é’®å¤§å°:', btn.offsetWidth, 'x', btn.offsetHeight);
}
```

3. **æ‰‹åŠ¨æ˜¾ç¤ºæµ®åŠ¨æŒ‰é’®**

```javascript
// å¼ºåˆ¶æ˜¾ç¤º
const btn = document.querySelector('.gm-subtitle-btn');
if (btn) {
    btn.style.display = 'flex';
    btn.style.visibility = 'visible';
    btn.style.opacity = '1';
}
```

### è§£å†³æ–¹æ¡ˆ

**æ–¹æ¡ˆ Aï¼šä½¿ç”¨å¿«æ·é”®ï¼ˆæ¨èï¼‰**

- ç›´æ¥æŒ‰ **S é”®** å¼€å¯å­—å¹•
- æ— éœ€ä¾èµ–æŒ‰é’®

**æ–¹æ¡ˆ Bï¼šç­‰å¾…æŒ‰é’®ç”Ÿæˆ**

- åˆ·æ–°é¡µé¢
- ç­‰å¾…è§†é¢‘å®Œå…¨åŠ è½½åï¼ˆ1-2ç§’ï¼‰
- è„šæœ¬ä¼šè‡ªåŠ¨åˆ›å»ºæµ®åŠ¨æŒ‰é’®

**æ–¹æ¡ˆ Cï¼šæŸ¥çœ‹æ§åˆ¶å°æ—¥å¿—**

```
æœŸæœ›çœ‹åˆ°çš„æ—¥å¿—ï¼š
[å­—å¹•] æ§åˆ¶æ æŸ¥æ‰¾ç»“æœ: { found: true/false, ... }
[å­—å¹•] âœ… æµ®åŠ¨æŒ‰é’®å·²åˆ›å»ºï¼Œä½ç½®: å³ä¸‹è§’
[å­—å¹•] æµ®åŠ¨æŒ‰é’®æ£€æŸ¥: { exists: true, visible: "48x48" }
```

---

## ğŸ› é—®é¢˜ 2ï¼šæ²¡æœ‰ç¿»è¯‘è¯·æ±‚ï¼Œåç«¯æ— æ—¥å¿—

### ç—‡çŠ¶

- æŒ‰ S é”®æˆ–ç‚¹å‡»æŒ‰é’®å
- å‰ç«¯æ²¡æœ‰å‘é€è¯·æ±‚
- åç«¯æ²¡æœ‰æ”¶åˆ°ä»»ä½•æ—¥å¿—

### å¯èƒ½åŸå› 

#### åŸå›  1ï¼šMediaRecorder å¯åŠ¨å¤±è´¥

**é”™è¯¯ä¿¡æ¯ï¼š**

```
NotSupportedError: Failed to execute 'start' on 'MediaRecorder'
```

**åŸå› ï¼š**

- è§†é¢‘è¿˜æ²¡å¼€å§‹æ’­æ”¾
- è§†é¢‘æ²¡æœ‰éŸ³è½¨
- æµè§ˆå™¨ä¸æ”¯æŒä»è§†é¢‘æ•è·éŸ³é¢‘

**è§£å†³æ–¹æ³•ï¼š**

1. **ç¡®ä¿è§†é¢‘æ­£åœ¨æ’­æ”¾**

   ```
   - ç‚¹å‡»æ’­æ”¾æŒ‰é’®
   - ç­‰å¾…è§†é¢‘å¼€å§‹æ’­æ”¾ï¼ˆæœ‰å£°éŸ³ï¼‰
   - ç„¶åæŒ‰ S é”®å¼€å¯å­—å¹•
   ```

2. **æ£€æŸ¥è§†é¢‘æ˜¯å¦æœ‰éŸ³é¢‘**

   ```javascript
   // åœ¨æ§åˆ¶å°è¿è¡Œ
   const video = document.querySelector('video');
   const stream = video.captureStream();
   const audioTracks = stream.getAudioTracks();
   console.log('éŸ³è½¨æ•°é‡:', audioTracks.length);
   // åº”è¯¥ > 0
   ```

3. **æ£€æŸ¥æµè§ˆå™¨æ”¯æŒ**

   ```javascript
   // æ£€æŸ¥ captureStream æ”¯æŒ
   const video = document.querySelector('video');
   console.log('captureStream:', !!video.captureStream);
   console.log('mozCaptureStream:', !!video.mozCaptureStream);
   // è‡³å°‘ä¸€ä¸ªåº”è¯¥æ˜¯ true
   ```

#### åŸå›  2ï¼šåç«¯æœåŠ¡æœªè¿è¡Œ

**æ£€æŸ¥æ–¹æ³•ï¼š**

```bash
# æ–¹æ³•1ï¼šcurl æµ‹è¯•
curl http://localhost:8765/health

# æ–¹æ³•2ï¼šæµè§ˆå™¨è®¿é—®
æ‰“å¼€ http://localhost:8765
# åº”è¯¥çœ‹åˆ°æœåŠ¡ä¿¡æ¯
```

**è§£å†³æ–¹æ³•ï¼š**

```bash
cd subtitle_backend
./start.sh
# ç­‰å¾…çœ‹åˆ° "æœåŠ¡åœ°å€: http://localhost:8765"
```

#### åŸå›  3ï¼šCORS è·¨åŸŸé—®é¢˜

**æ£€æŸ¥æ§åˆ¶å°é”™è¯¯ï¼š**

```
Access to fetch at 'http://localhost:8765' has been blocked by CORS policy
```

**è§£å†³æ–¹æ³•ï¼š**

- åç«¯å·²é…ç½® CORSï¼Œå…è®¸æ‰€æœ‰æ¥æº
- å¦‚æœè¿˜æœ‰é—®é¢˜ï¼Œæ£€æŸ¥æµè§ˆå™¨å®‰å…¨è®¾ç½®

#### åŸå›  4ï¼šé…ç½®åœ°å€é”™è¯¯

**æ£€æŸ¥é…ç½®ï¼š**

```javascript
// åœ¨æ§åˆ¶å°è¿è¡Œ
console.log('å­—å¹•é…ç½®:', {
    serverUrl: GM_getValue('subtitle_serverUrl', 'http://localhost:8765'),
    targetLang: GM_getValue('subtitle_targetLang', 'zh-CN'),
    autoTranslate: GM_getValue('subtitle_autoTranslate', true)
});
```

**ä¿®æ”¹é…ç½®ï¼š**

- æ²¹çŒ´èœå• â†’ âš™ï¸ å­—å¹•ç¿»è¯‘é…ç½®
- ç¡®è®¤æœåŠ¡åœ°å€ï¼š`http://localhost:8765`

---

## ğŸ” å®Œæ•´çš„è°ƒè¯•æµç¨‹

### æ­¥éª¤ 1ï¼šæ£€æŸ¥åç«¯æœåŠ¡

```bash
# 1. æ£€æŸ¥æœåŠ¡æ˜¯å¦è¿è¡Œ
curl http://localhost:8765/health

# æœŸæœ›å“åº”ï¼š
# {"status":"healthy","model_loaded":true}

# 2. å¦‚æœå¤±è´¥ï¼Œå¯åŠ¨æœåŠ¡
cd subtitle_backend
./start.sh
```

### æ­¥éª¤ 2ï¼šæ£€æŸ¥å‰ç«¯è„šæœ¬

```javascript
// åœ¨æµè§ˆå™¨æ§åˆ¶å°ï¼ˆF12ï¼‰è¿è¡Œ

// 1. æ£€æŸ¥è§†é¢‘å…ƒç´ 
const video = document.querySelector('video');
console.log('è§†é¢‘:', video);
console.log('æ’­æ”¾çŠ¶æ€:', !video.paused);

// 2. æ£€æŸ¥éŸ³é¢‘æ•è·æ”¯æŒ
console.log('captureStream:', !!video.captureStream);
const stream = video.captureStream();
console.log('éŸ³è½¨:', stream.getAudioTracks().length);

// 3. æ£€æŸ¥å­—å¹•æœåŠ¡
console.log('å­—å¹•æœåŠ¡:', window.subtitleService);
```

### æ­¥éª¤ 3ï¼šæµ‹è¯•å­—å¹•å¯åŠ¨

```javascript
// 1. ç¡®ä¿è§†é¢‘æ­£åœ¨æ’­æ”¾
const video = document.querySelector('video');
if (video.paused) video.play();

// 2. ç­‰å¾… 1-2 ç§’åï¼ŒæŒ‰ S é”®

// 3. è§‚å¯Ÿæ§åˆ¶å°æ—¥å¿—
// åº”è¯¥çœ‹åˆ°ï¼š
// [å­—å¹•] å¯åŠ¨æœåŠ¡...
// [å­—å¹•] åç«¯æœåŠ¡çŠ¶æ€: {...}
// [å­—å¹•] âœ… éŸ³é¢‘æ•è·åˆå§‹åŒ–æˆåŠŸ
// [å­—å¹•] âœ… å¼€å§‹å½•åˆ¶éŸ³é¢‘ (5 ç§’)
```

### æ­¥éª¤ 4ï¼šè§‚å¯Ÿå½•åˆ¶å’Œå‘é€

ç­‰å¾… 5 ç§’åï¼Œåº”è¯¥çœ‹åˆ°ï¼š

```
[å­—å¹•] åœæ­¢å½•åˆ¶ï¼Œå‡†å¤‡å¤„ç†
[å­—å¹•] å¤„ç†éŸ³é¢‘æ•°æ®ï¼Œchunks: X
[å­—å¹•] éŸ³é¢‘å¤§å°: XX.XX KB
[å­—å¹•] å‘é€éŸ³é¢‘åˆ°åç«¯: {...}
[å­—å¹•] è¯·æ±‚è€—æ—¶: XXXms, çŠ¶æ€: 200
[å­—å¹•] åç«¯å“åº”: {...}
[å­—å¹•] âœ… è·å– X æ¡å­—å¹•
```

---

## ğŸ’¡ å¿«é€Ÿè§£å†³æ–¹æ¡ˆ

### æŒ‰é’®é—®é¢˜

```
ç›´æ¥ä½¿ç”¨ S é”®ï¼Œä¸ä¾èµ–æŒ‰é’®ï¼
```

### å½•åˆ¶å¤±è´¥

```
1. ç¡®ä¿è§†é¢‘æ­£åœ¨æ’­æ”¾ï¼ˆæœ‰å£°éŸ³ï¼‰
2. ç­‰å¾…è§†é¢‘æ’­æ”¾ 2-3 ç§’
3. ç„¶åæŒ‰ S é”®å¼€å¯å­—å¹•
```

### åç«¯è¿æ¥å¤±è´¥

```bash
# é‡å¯åç«¯æœåŠ¡
cd subtitle_backend
pkill -f "python server.py"  # æ€æ­»æ—§è¿›ç¨‹
./start.sh  # é‡æ–°å¯åŠ¨
```

### å®Œæ•´é‡ç½®

```bash
# 1. åœæ­¢æœåŠ¡
pkill -f "python server.py"

# 2. æ¸…é™¤é…ç½®
# æ²¹çŒ´èœå• â†’ åˆ é™¤è„šæœ¬å¹¶é‡æ–°å®‰è£…

# 3. é‡æ–°å¯åŠ¨
cd subtitle_backend
./start.sh

# 4. åˆ·æ–°ç½‘é¡µï¼Œæ’­æ”¾è§†é¢‘åæŒ‰ S é”®
```

---

## ğŸ¯ æˆåŠŸçš„æ ‡å¿—

### å‰ç«¯

```
âœ… [å­—å¹•] æœåŠ¡å·²å¯åŠ¨æˆåŠŸ
âœ… [å­—å¹•] âœ… å¼€å§‹å½•åˆ¶éŸ³é¢‘
âœ… [å­—å¹•] éŸ³é¢‘å¤§å°: XX KB
âœ… [å­—å¹•] è¯·æ±‚è€—æ—¶: XXXms, çŠ¶æ€: 200
âœ… [å­—å¹•] âœ… è·å– X æ¡å­—å¹•
âœ… å­—å¹•æ˜¾ç¤ºåœ¨è§†é¢‘åº•éƒ¨
```

### åç«¯

```
âœ… INFO: Started server process
âœ… INFO: Waiting for application startup
âœ… æ­£åœ¨åŠ è½½ Whisper æ¨¡å‹: base
âœ… Whisper æ¨¡å‹åŠ è½½æˆåŠŸ
âœ… å­—å¹•ç¿»è¯‘æœåŠ¡å¯åŠ¨æˆåŠŸ
âœ… INFO: æ¥æ”¶åˆ°éŸ³é¢‘æ–‡ä»¶: audio.webm
âœ… INFO: å¼€å§‹è½¬å½•éŸ³é¢‘
âœ… INFO: æ£€æµ‹åˆ°è¯­è¨€: en
âœ… INFO: è½¬å½•å®Œæˆï¼Œå…± X ä¸ªå­—å¹•ç‰‡æ®µ
```

---

## ğŸ“ è¿˜æ˜¯ä¸è¡Œï¼Ÿ

### æ”¶é›†è°ƒè¯•ä¿¡æ¯

```javascript
// åœ¨æ§åˆ¶å°è¿è¡Œå®Œæ•´è¯Šæ–­
console.log('=== å­—å¹•åŠŸèƒ½è¯Šæ–­ ===');
console.log('1. è§†é¢‘å…ƒç´ :', document.querySelector('video'));
console.log('2. è§†é¢‘æ’­æ”¾:', !document.querySelector('video').paused);
console.log('3. captureStream:', !!document.querySelector('video').captureStream);
console.log('4. å­—å¹•æŒ‰é’®:', document.querySelector('.gm-subtitle-btn'));
console.log('5. æµ®åŠ¨æŒ‰é’®:', document.querySelector('.gm-floating-btn'));
console.log('6. å­—å¹•æœåŠ¡:', window.subtitleService);
console.log('7. é…ç½®:', {
    serverUrl: GM_getValue('subtitle_serverUrl'),
    targetLang: GM_getValue('subtitle_targetLang')
});
```

```bash
# åç«¯è¯Šæ–­
curl http://localhost:8765/health
curl http://localhost:8765/languages
```

### æä¾›ä¿¡æ¯

å¦‚æœè¿˜æœ‰é—®é¢˜ï¼Œè¯·æä¾›ï¼š

1. æµè§ˆå™¨ç±»å‹å’Œç‰ˆæœ¬
2. è§†é¢‘ç½‘ç«™URL
3. æ§åˆ¶å°å®Œæ•´æ—¥å¿—
4. åç«¯æœåŠ¡æ—¥å¿—
5. ä¸Šè¿°è¯Šæ–­ä¿¡æ¯çš„è¾“å‡º

---

**å¤§å¤šæ•°é—®é¢˜éƒ½æ˜¯å› ä¸ºè§†é¢‘æœªæ’­æ”¾å°±å¼€å¯å­—å¹•å¯¼è‡´çš„ï¼**

**è®°ä½ï¼šå…ˆæ’­æ”¾è§†é¢‘ï¼Œå†æŒ‰ S é”®ï¼** â–¶ï¸ â†’ S
