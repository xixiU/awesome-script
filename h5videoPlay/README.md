# HTML5 视频播放工具

> 功能强大的视频播放增强脚本，支持快捷键控制、实时字幕翻译等功能

## ✨ 核心功能

### 🎬 视频控制

- **播放速度**：0.1x - 16x 任意调节，快捷键 V/X/Z
- **精确控制**：逐帧前进/后退（D/E/F 键）
- **快速跳转**：5秒/20秒快进快退（方向键）
- **截图保存**：P 键一键截图
- **画中画**：I 键开启浮窗播放
- **全屏控制**：Enter 切换全屏

### 🌍 实时字幕翻译 🆕

- **自动识别**：faster-whisper 语音转文字
- **多语言翻译**：支持中英日韩法德西俄等 12+ 种语言
- **智能显示**：自动适配播放器，美观字幕UI
- **一键控制**：S 键或点击 📝 按钮
- **本地处理**：隐私安全，数据不上传

### 🤖 智能检测

- **自动适配**：无需手动配置，自动识别所有 HTML5 视频网站
- **零损耗**：非视频页面不启动，节省 98% 资源
- **通用兼容**：YouTube、B站、优酷等主流网站 + 所有未知视频网站

## ⌨️ 快捷键

| 快捷键 | 功能 | 备注 |
|--------|------|------|
| **V** / **X** / **Z** | 加速 / 减速 / 切换速度 | YouTube 用 V，其他用 C |
| **← →** | 快退/快进 5 秒 | Shift + 方向键 = 20 秒 |
| **↑ ↓** | 增加/减少音量 | |
| **Space** | 暂停/播放 | |
| **Enter** | 全屏 | Shift + Enter = 网页全屏 |
| **S** | 开启/关闭字幕翻译 🆕 | 需启动后端服务 |
| **P** | 视频截图 | 自动保存 PNG |
| **I** | 画中画模式 | |
| **M** | 缓存视频 | |
| **N** | 下一集 | |
| **D** / **E/F** | 上一帧 / 下一帧 | YouTube 用 E |

## 🚀 安装使用

### 基础安装

1. **安装 Tampermonkey**
   - Chrome/Edge: [下载](https://chrome.google.com/webstore/detail/tampermonkey/dhdgffkkebhmkfjojejmpbldmpobfkfo)
   - Firefox: [下载](https://addons.mozilla.org/firefox/addon/tampermonkey/)

2. **安装脚本**
   - 打开 Tampermonkey 管理面板
   - 创建新脚本，复制 `html5videoPlay.js` 内容
   - 保存并启用

3. **开始使用**
   - 访问任何视频网站即可使用快捷键

### 字幕翻译功能（可选）

如需实时字幕翻译：

```bash
# 1. 启动后端服务
cd subtitle_backend
./start.sh

# 2. 使用字幕
# 访问视频网站，按 S 键或点击控制栏 📝 按钮
```

**配置语言：**

- 油猴菜单 → ⚙️ 字幕翻译配置
- 输入目标语言代码：`zh-CN`（中文）、`en`（英语）、`ja`（日语）等

## ⚙️ 配置选项

点击油猴图标 → 选择脚本，可配置：

- **脚本功能快捷键表** - 查看所有快捷键
- **√ 记忆播放速度** - 自动记住上次速度
- **⚙️ 字幕翻译配置** - 配置服务地址和目标语言
- **🔄 重启字幕服务** - 重启字幕识别

## 🌐 支持的网站

**自动支持所有包含 HTML5 `<video>` 标签的网站**

已优化适配：

- YouTube ⭐、Bilibili ⭐、优酷、爱奇艺、腾讯视频
- 西瓜视频、抖音、TED、Twitch
- 斗鱼、虎牙等直播平台
- 以及所有新兴视频网站

## 🐛 故障排查

### 脚本未启动？

- 刷新页面重试
- 打开控制台（F12）查看日志
- 确认脚本已启用

### 字幕不显示？

- 检查后端服务：`curl http://localhost:8765/health`
- 查看控制台错误信息
- 确认浏览器支持音频捕获

### YouTube 快捷键无效？

- 确认使用 V 键（不是 C 键）
- 确认使用 E 键下一帧（不是 F 键）
- 刷新页面重新加载脚本

## 📋 更新日志

### v2.2.0 (2024-11-14)

**🌍 实时字幕翻译**

- 集成 faster-whisper 语音识别
- 支持 12+ 种语言翻译
- 智能控制栏按钮（适配 7+ 种播放器）
- S 键快捷键控制

**🔧 配置管理优化**

- 集成统一的 ConfigManager
- 完整国际化支持（中英意三语）
- 简化菜单注册逻辑（代码减少 60%）

**📝 其他改进**

- 更新多语言帮助文本
- 优化按钮UI和交互
- 完善错误处理

### v2.1.0 (2024-11-14)

**🎯 智能检测机制**

- 从 50+ 个 @match 规则简化为 1 个通用规则
- 四层智能检测：排除列表 → 已知网站 → URL 关键词 → DOM 元素
- 自动支持所有 HTML5 视频网站
- 非视频页面零资源占用

**🐛 YouTube Trusted Types 修复**

- 创建 Trusted Types 策略
- 重构提示框创建逻辑
- 优化快捷键映射（V/X/Z/E）

## 💻 技术信息

- **版本**：2.2.0
- **许可**：MIT License
- **原作者**：Greasyfork 用户 7036
- **主页**：<https://bbs.kafan.cn/thread-2093014-1-1.html>

### 技术栈

**前端：**

- JavaScript ES6+ / Tampermonkey
- jQuery 3.6.4 + Vue.js 2.7.16
- MediaRecorder API + captureStream API

**后端（字幕功能）：**

- Python 3.8+ / FastAPI
- faster-whisper（语音识别）
- deep-translator（翻译）

## 🆘 常见问题

**Q: 支持哪些浏览器？**  
A: Chrome/Edge（推荐）、Firefox、Opera。Safari 部分支持。

**Q: 字幕有延迟吗？**  
A: 是的，5-10 秒延迟是正常的（语音识别和翻译需要时间）。

**Q: 可以离线使用吗？**  
A: 视频控制功能可以离线使用。字幕翻译需要网络（识别本地，翻译需网络）。

**Q: 如何自定义快捷键？**  
A: 目前不支持自定义，使用默认快捷键。

**Q: 会保存视频数据吗？**  
A: 不会。音频仅在本地处理，临时文件自动清理。

## 🙏 致谢

- Greasyfork 用户 7036 - 原始脚本
- Dario Costa - 英语和意大利语翻译
- faster-whisper、OpenAI Whisper - 语音识别技术
- 所有用户的反馈和建议

---

**📖 后端服务文档：** [subtitle_backend/README.md](./subtitle_backend/README.md)

**💡 提示：** 查看油猴菜单获取帮助和配置选项

**🎬 立即开始，享受更好的视频观看体验！**
