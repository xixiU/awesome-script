# HTML5 视频播放工具

> 功能强大的视频播放增强工具，支持快捷键控制、实时字幕翻译等功能

## 🎉 Chrome 扩展版本测试中

**⭐ 推荐使用 Chrome 扩展版本** - 支持所有网站的字幕翻译！

| 版本 | 字幕支持 | 安装方式 |
|------|---------|---------|
| **Chrome 扩展** ⭐ | ✅ YouTube、B站等所有网站 | [安装说明](./扩展版本说明.md) |
| 油猴脚本 | ❌ 受浏览器限制 | 本文档 |

**查看：** [扩展版本说明.md](./扩展版本说明.md)

## ✨ 核心功能

### 🎬 视频控制

- **播放速度**：0.1x - 16x 任意调节，快捷键 V/X/Z
- **精确控制**：逐帧前进/后退（D/E/F 键）
- **快速跳转**：5秒/20秒快进快退（方向键）
- **截图保存**：P 键一键截图
- **画中画**：I 键开启浮窗播放
- **全屏控制**：Enter 切换全屏

### 🌍 实时字幕翻译 🆕

- **自动识别**：faster-whisper 语音转文字
- **多语言翻译**：支持中英日韩法德西俄等 12+ 种语言
- **智能显示**：自动适配播放器，美观字幕UI
- **一键控制**：S 键或点击 📝 按钮
- **本地处理**：隐私安全，数据不上传

**⚠️ 跨域限制：**

- ✅ 支持：**Bilibili（B站）**、部分国内视频网站
- ❌ 不支持：YouTube、TED等（视频从CDN跨域加载）
- 原因：浏览器安全策略限制

### 🤖 智能检测

- **自动适配**：无需手动配置，自动识别所有 HTML5 视频网站
- **零损耗**：非视频页面不启动，节省 98% 资源
- **通用兼容**：YouTube、B站、优酷等主流网站 + 所有未知视频网站

## ⌨️ 快捷键

| 快捷键 | 功能 | 备注 |
|--------|------|------|
| **V** / **X** / **Z** | 加速 / 减速 / 切换速度 | YouTube 用 V，其他用 C |
| **← →** | 快退/快进 5 秒 | Shift + 方向键 = 20 秒 |
| **↑ ↓** | 增加/减少音量 | |
| **Space** | 暂停/播放 | |
| **Enter** | 全屏 | Shift + Enter = 网页全屏 |
| **S** | 开启/关闭字幕翻译 🆕 | 仅支持同域视频 |
| **P** | 视频截图 | 自动保存 PNG |
| **I** | 画中画模式 | |
| **M** | 缓存视频 | |
| **N** | 下一集 | |
| **D** / **E/F** | 上一帧 / 下一帧 | YouTube 用 E |

## 🚀 安装使用

### 基础安装

1. **安装 Tampermonkey**
   - Chrome/Edge: [下载](https://chrome.google.com/webstore/detail/tampermonkey/dhdgffkkebhmkfjojejmpbldmpobfkfo)
   - Firefox: [下载](https://addons.mozilla.org/firefox/addon/tampermonkey/)

2. **安装脚本**
   - 打开 Tampermonkey 管理面板
   - 创建新脚本，复制 `html5videoPlay.js` 内容
   - 保存并启用

3. **开始使用**
   - 访问任何视频网站即可使用快捷键

### 字幕翻译功能（可选）

**支持的网站：** Bilibili（B站）、部分国内视频网站（同域视频）

**不支持的网站：** YouTube、TED、大部分国外网站（跨域CDN视频）

```bash
# 1. 启动后端服务
cd subtitle_backend
./start.sh

# 2. 访问 B站等支持的网站
# 3. 播放视频（确保有声音）⭐ 重要
# 4. 按 S 键开启字幕
# 5. 查看右下角浮动按钮 📝（圆形，黑色半透明）
```

**故障排查：** 查看 [故障排查.md](./故障排查.md)

**功能测试：** 打开 [test_page.html](./test_page.html) 进行本地测试

## ⚙️ 配置选项

点击油猴图标 → 选择脚本，可配置：

- **脚本功能快捷键表** - 查看所有快捷键
- **√ 记忆播放速度** - 自动记住上次速度
- **⚙️ 字幕翻译配置** - 配置服务地址和目标语言
- **🔄 重启字幕服务** - 重启字幕识别

## 🌐 支持的网站

**自动支持所有包含 HTML5 `<video>` 标签的网站**

已优化适配：

- Bilibili（B站）⭐ - 视频控制 + 字幕翻译
- YouTube ⭐ - 仅视频控制
- 优酷、爱奇艺、腾讯视频 - 视频控制
- 西瓜视频、抖音、TED、Twitch - 视频控制
- 斗鱼、虎牙等直播平台 - 视频控制
- 所有新兴视频网站 - 自动适配

## 🐛 故障排查

### 字幕功能

**问题：** 提示 "录制失败" 或 "chunks: 0"  
**原因：** 跨域视频限制  
**解决：** 在 B站等同域网站使用，或使用测试页面验证

**问题：** 看不到浮动按钮  
**解决：** 直接按 S 键，无需按钮

**问题：** 后端连接失败  
**解决：** 检查服务：`curl http://localhost:8765/health`

### 视频控制

**问题：** YouTube 快捷键无效  
**解决：** 使用 V/E 键（不是 C/F 键）

**问题：** 脚本未启动  
**解决：** 刷新页面，查看控制台（F12）

## 📋 更新日志

### v2.2.0 (2024-11-14)

**🌍 实时字幕翻译**

- 集成 faster-whisper 语音识别
- 支持 12+ 种语言翻译
- 智能控制栏按钮 + 浮动按钮
- S 键快捷键控制
- ⚠️ 注意：仅支持同域视频（B站等）

**🔧 配置管理优化**

- 集成统一的 ConfigManager
- 完整国际化支持（中英意三语）
- 简化菜单注册逻辑

**🐛 调试改进**

- 添加详细的日志输出
- 跨域检测和提示
- timeslice 参数优化
- 多种 MIME 类型支持

### v2.1.0 (2024-11-14)

**🎯 智能检测机制**

- 从 50+ 个 @match 规则简化为 1 个
- 自动支持所有 HTML5 视频网站

**🐛 YouTube Trusted Types 修复**

- 完美兼容 YouTube
- 优化快捷键映射

## 💻 技术信息

- **版本**：2.2.0
- **许可**：MIT License
- **原作者**：Greasyfork 用户 7036

### 技术栈

**前端：** JavaScript ES6+ / Tampermonkey / jQuery 3.6.4 + Vue.js 2.7.16  
**后端：** Python 3.8+ / FastAPI / faster-whisper

## 🆘 常见问题

**Q: 字幕功能支持哪些网站？**  
A: 仅支持同域视频网站（B站等）。YouTube等跨域网站因浏览器限制无法使用。

**Q: 为什么 YouTube 不支持字幕？**  
A: YouTube 视频从 googlevideo.com 加载（跨域），浏览器阻止音频捕获。

**Q: 如何测试字幕功能？**  
A: 打开 test_page.html 或在 B站测试。

**Q: chunks: 0 是什么意思？**  
A: MediaRecorder 没有捕获到音频数据，通常是跨域限制导致。

**Q: 可以离线使用吗？**  
A: 视频控制功能可离线。字幕识别本地，翻译需网络。

## 🙏 致谢

- Greasyfork 用户 7036 - 原始脚本
- Dario Costa - 英语和意大利语翻译
- faster-whisper、OpenAI Whisper - 语音识别
- 所有用户的反馈和建议

---

**📖 更多文档：**

- [故障排查.md](./故障排查.md) - 详细的问题排查指南
- [项目说明.md](./项目说明.md) - 项目架构和技术说明
- [subtitle_backend/README.md](./subtitle_backend/README.md) - 后端服务文档
- [test_page.html](./test_page.html) - 功能测试页面

**🎬 立即开始，享受更好的视频观看体验！**
