# 集成字幕功能使用指南

## 🎉 字幕功能已完全集成

实时字幕翻译功能现已完全集成到 `html5videoPlay.js` 主脚本中，无需安装额外的脚本！

## 🚀 快速开始

### 步骤 1：启动后端服务

```bash
cd /Users/yuanrongjie/software/python_project/awesome-script/videoPlay/subtitle_backend
./start.sh
```

服务启动后会显示：

```
服务地址: http://localhost:8765
按 Ctrl+C 停止服务
```

### 步骤 2：使用字幕功能

打开任何视频网站（YouTube, B站, 优酷等），有三种方式使用字幕：

#### 方式一：快捷键（最快）

- 按 **S 键** 开启/关闭实时字幕

#### 方式二：控制栏按钮

- 在视频播放器控制栏找到 📝 字幕按钮
- 点击按钮开启/关闭字幕
- 按钮会高亮显示当前状态

#### 方式三：浮动按钮

- 如果播放器控制栏没有按钮
- 会在页面右下角显示浮动字幕按钮

## ⚙️ 配置字幕

### 通过油猴菜单配置

1. 点击浏览器工具栏的油猴图标
2. 选择 **HTML5视频播放工具**
3. 在弹出菜单中选择：

#### ⚙️ 字幕翻译配置

- **后端服务地址**：默认 `http://localhost:8765`
- **目标翻译语言**：默认 `zh-CN`（简体中文）
- **自动翻译开关**：是否自动翻译识别的文字

#### 🔄 重启字幕服务

- 当更改配置后，可以重启服务使其生效
- 或者关闭再重新开启字幕

## 🌍 支持的语言

| 语言代码 | 语言名称 |
|---------|---------|
| `zh-CN` | 简体中文（默认） |
| `zh-TW` | 繁体中文 |
| `en` | 英语 |
| `ja` | 日语 |
| `ko` | 韩语 |
| `fr` | 法语 |
| `de` | 德语 |
| `es` | 西班牙语 |
| `ru` | 俄语 |
| `pt` | 葡萄牙语 |
| `it` | 意大利语 |
| `ar` | 阿拉伯语 |

## 🎨 字幕样式

字幕会自动显示在视频底部，特点：

- **白色文字** + 黑色半透明背景
- 自动换行，适应视频宽度
- 阴影效果，提高可读性
- 不遮挡控制栏

## 💡 使用技巧

### 1. 获得最佳识别效果

- 确保视频音质清晰
- 避免背景噪音过大
- 适当调整音量

### 2. 减少延迟

- 使用有线网络连接
- 确保后端服务本地运行
- 关闭其他占用资源的程序

### 3. 提高翻译准确性

- 指定正确的源语言（在后端）
- 使用更大的 Whisper 模型
- 检查网络连接（翻译需要网络）

## 🎯 支持的网站

字幕功能适用于所有 HTML5 视频网站，特别优化的网站包括：

- **YouTube** ⭐
- **Bilibili（B站）** ⭐
- 优酷
- 爱奇艺
- 腾讯视频
- 西瓜视频
- 抖音
- 等所有使用 HTML5 video 标签的网站

## 🔧 故障排查

### 问题：按 S 键没反应

**解决方法：**

1. 确认脚本已启用（查看油猴图标）
2. 刷新页面重试
3. 检查浏览器控制台是否有错误

### 问题：字幕按钮没有出现

**原因：** 控制栏可能使用了特殊结构

**解决方法：**

1. 使用浮动按钮（右下角）
2. 直接使用 S 键快捷键
3. 刷新页面让脚本重新检测

### 问题：提示"字幕服务连接失败"

**解决方法：**

1. 检查后端服务是否运行：

   ```bash
   curl http://localhost:8765/health
   ```

2. 查看后端服务的日志输出
3. 检查服务地址配置是否正确
4. 确认防火墙没有阻止连接

### 问题：字幕不准确

**优化方法：**

1. 在后端使用更大的模型：

   ```python
   # 在 server.py 中修改
   subtitle_service = SubtitleService(model_size="small")  # 或 medium
   ```

2. 手动指定源语言
3. 调整音频捕获间隔（配置中）

### 问题：字幕有延迟

**原因：** 需要时间进行语音识别和翻译

**说明：**

- 正常延迟：5-10 秒
- 这是实时识别的固有特性
- 可以通过减少捕获间隔来降低延迟

## 📊 性能说明

| 配置 | 识别速度 | 准确率 | 内存占用 |
|------|---------|--------|----------|
| tiny 模型 | 极快 | 中等 | ~1GB |
| base 模型（默认） | 快 | 良好 | ~1.5GB |
| small 模型 | 中等 | 很好 | ~2.5GB |
| medium 模型 | 较慢 | 优秀 | ~5GB |

## 🔒 隐私说明

- ✅ 音频仅在本地网络传输（localhost）
- ✅ 不会保存任何音视频数据
- ✅ 临时文件自动清理
- ⚠️ 翻译功能需要访问 Google Translate API

## 🎓 工作原理

```
视频播放
    ↓
音频捕获（每5秒）
    ↓
发送到本地后端
    ↓
语音识别（faster-whisper）
    ↓
文本翻译（Google Translator）
    ↓
返回字幕数据
    ↓
显示在视频上
```

## 📱 浏览器兼容性

| 浏览器 | 支持状态 | 说明 |
|--------|---------|------|
| Chrome | ✅ 完全支持 | 推荐使用 |
| Edge | ✅ 完全支持 | 推荐使用 |
| Firefox | ✅ 支持 | 需要 captureStream 支持 |
| Safari | ⚠️ 部分支持 | 某些网站可能不支持音频捕获 |
| Opera | ✅ 支持 | 基于 Chromium |

## 🆘 获取帮助

如果遇到问题：

1. **查看日志**
   - 浏览器控制台（F12）
   - 后端服务终端输出

2. **测试API**

   ```bash
   cd subtitle_backend
   python test_api.py
   ```

3. **检查配置**
   - 油猴菜单 → 字幕翻译配置
   - 确认所有设置正确

4. **重启服务**
   - 停止后端服务（Ctrl+C）
   - 重新启动：`./start.sh`
   - 在油猴菜单中重启字幕服务

## 💻 快捷键总结

| 快捷键 | 功能 |
|--------|------|
| **S** | 开启/关闭字幕 |
| **V/X/Z** | 速度控制 |
| **←/→** | 快退/快进 |
| **P** | 截图 |
| **I** | 画中画 |
| **Enter** | 全屏 |

## 🎉 开始使用

1. 确保后端服务运行中
2. 访问任何视频网站
3. 按 **S 键** 开启字幕
4. 享受实时翻译！

---

**让视频观看无语言障碍！** 🌍✨
